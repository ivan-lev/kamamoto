# front/Dockerfile
FROM node:24-alpine AS builder

WORKDIR /app

# Копируем package.json и package-lock.json
COPY package*.json ./

# Устанавливаем зависимости
RUN npm ci

# Копируем исходный код
COPY . .

# Собираем приложение
RUN npm run build

# Финальный образ только с собранными файлами
FROM alpine:latest

# Устанавливаем необходимые инструменты для копирования
RUN apk add --no-cache bash

# Создаем директорию для статических файлов
RUN mkdir -p /srv/front

# Копируем собранные файлы из builder stage
COPY --from=builder /app/dist /srv/front

# Создаем volume точку монтирования
VOLUME /srv/front

# Команда которая просто держит контейнер активным
CMD ["tail", "-f", "/dev/null"]